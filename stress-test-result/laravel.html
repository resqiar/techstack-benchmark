<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Data</title>
    <style>
        body {
            min-width: 100vw;
            padding-top: 5px;
            font-family: Roboto, monospace;
        }

        .outer {
            padding: 20px;
        }

        h2, h3 {
            font-weight: normal;
        }

        hr {
            margin: 5px 0;
            clear: both;
        }

        .stats {
            float: left;
        }

    </style>
</head>
<body>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<div class="outer">
    <div>
        <h1>http://127.0.0.1:8000</h1>
    </div>
    <div class="stats">
        <h2>Output:</h2>
        <h3>  S=    31 |   T=582589 | A=     0</h3>
<h3>  E= 15124 | T/O=276153 | W/B=    35 | AVG= 18927 | MIN=  6434 | MAX= 43078</h3>
<h3>1xx=     0 | 2xx=    35 | 3xx=     0 | 4xx=     0 | 5xx=     0</h3>
<h3></h3>
    </div>
    <hr>
    <div id="chart_div"></div>
    <hr>
    <div id="chart_div_2"></div>
    <script>
        google.charts.load('current', { packages: ['corechart', 'bar', 'line'] });
        google.charts.setOnLoadCallback(draw);

        function extractTimes() {
            var maxtime = times.reduce(function(max, val) {
                return max > val ? max : val
            }, 0);
            var cnt = 1000;
            if (maxtime < cnt) {
                cnt = maxtime;
            }
            var chunk = maxtime / cnt;

            var list = [];
            for (var i = 0; i < cnt; i++) {
                list.push(null);
            }
            times.forEach(function(time) {
                var idx = (time / chunk ) | 0;
                if (!list[idx])list[idx] = [(idx * chunk | 0), 0];
                list[idx][1]++;
            });
            return list;
        }

        function drawTimes() {
            var data = new google.visualization.DataTable();
            data.addColumn('number', 'Ms');
            data.addColumn('number', 'Requests');

            data.addRows(extractTimes());

            var options = {
                chart: {
                    title: 'Average response time',
                    subtitle: ''
                },
                height: 500,
                hAxis: {
                    title: 'ms'
                },
                vAxis: {
                    title: 'Requests',
                    color: '#64B5F6'
                }
            };

            var chart = new google.charts.Bar(document.getElementById('chart_div'));
            chart.draw(data, google.charts.Bar.convertOptions(options));
        }

        function drawReqPerSec() {
            var data = new google.visualization.DataTable();
            data.addColumn('number', 'Seconds');
            data.addColumn('number', 'Pending Requests');
            data.addColumn('number', 'Timeouts');
            data.addColumn('number', 'Errors');
            data.addColumn('number', 'Min response time');
            data.addColumn('number', 'Mean response time');
            data.addColumn('number', 'Max response time');

            var rps = secondHistory.map(function(r, idx) {
                var hasTimeMetrict = r.cnt > 0;
                var val = [
                    idx,
                    r.active,
                    r.to,
                    r.err,

                    hasTimeMetrict ? r.min : null,

                    hasTimeMetrict ? r.time / r.cnt : null,

                    hasTimeMetrict ? r.max : null
                ];
                return val;
            });

            data.addRows(rps);

            var options = {
                chart: {
                    title: 'Request count / Response times',
                    subtitle: ''
                },
                height: 500,
                hAxis: {
                    title: 'seconds'
                },
                series: {
                    0: { axis: 'requests', color: '#64B5F6' },
                    1: { axis: 'requests', color: '#4A148C' },
                    2: { axis: 'requests', color: '#78909C' },
                    3: { axis: 'time', color: '#4CAF50' },
                    4: { axis: 'time', color: '#FFF176' },
                    5: { axis: 'time', color: '#e53935' }
                },
                axes: {
                    y: {
                        requests: { label: 'Requests' },
                        error: { side: 'left', label: 'Errors' },
                        time: { side: 'right', label: 'Milliseconds' }
                    }
                }
            };

            var chart = new google.charts.Line(document.getElementById('chart_div_2'));
            chart.draw(data, google.charts.Line.convertOptions(options));
        }

        function draw() {
            drawTimes();
            drawReqPerSec();
        }

        var secondHistory = [{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":0,"to":0,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":10000},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":0,"to":0,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":19587},{"code":{"1":0,"2":35,"3":0,"4":0,"5":0},"err":420,"to":1155,"body":35,"cnt":35,"time":227391,"min":0,"max":6565,"active":28390},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":4143,"to":11287,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":22627},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":0,"to":10012,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":22948},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":11,"to":7390,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":25547},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":388,"to":15328,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":19831},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":126,"to":1800,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":27895},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":1180,"to":17982,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":18743},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":111,"to":1578,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":27054},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":230,"to":8023,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":28801},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":539,"to":8880,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":29382},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":658,"to":13435,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":25289},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":302,"to":9892,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":25095},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":498,"to":14546,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":20051},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":246,"to":7618,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":22189},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":505,"to":10327,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":21260},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":236,"to":5265,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":25854},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":557,"to":12931,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":22366},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":293,"to":10964,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":21109},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":228,"to":6404,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":24477},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":410,"to":10098,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":23969},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":523,"to":10765,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":22681},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":456,"to":4028,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":28197},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":643,"to":10917,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":26637},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":378,"to":9964,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":26295},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":658,"to":17044,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":18593},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":181,"to":3580,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":24820},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":168,"to":9794,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":24870},{"code":{"1":0,"2":0,"3":0,"4":0,"5":0},"err":297,"to":9410,"body":0,"cnt":0,"time":0,"min":0,"max":0,"active":25149}];
        var times = [6461,6448,6434,6434,6447,6447,6447,6444,6443,6437,6437,6438,6437,6455,6535,6510,6526,6526,6527,6535,6535,6535,6535,6536,6525,6524,6525,6534,6535,6534,6535,6535,6535,6535,6565];


    </script>
</div>
</body>
</html>